<div *ngIf="isWaitingForResponse" class="inner-loading-indicator">
  <mat-spinner color="primary" [diameter]="100"></mat-spinner>
</div>
<div class="p-2 h-full">
    <div class="flex flex-row justify-between mb-2">
      <div class="flex flex-row">
        <button (click)="OpenFormToCreate()" class="mr-1" color="primary" mat-raised-button>+ Ajukan Permohohan</button>
      </div>
      <div class="flex flex-row">
        <div class="ml-1">
          <button color="none" (click)="resetTable()" mat-raised-button>
            <mat-icon>refresh</mat-icon>
            <span>Hapus Filter</span>
          </button>
        </div>
      </div>
    </div>
    <div class="mat-elevation-z8 horizontal">
      <table class="mat-elevation-z8"  mat-table [dataSource]="dataSource" matSort (matSortChange)="onSort($event)">

        <!-- Fillter Section -->

        <ng-container matColumnDef="none_filter">
          <th mat-header-cell *matHeaderCellDef>

          </th>
        </ng-container>

          <ng-container  matColumnDef="work_letter_number_filter">
            <th mat-header-cell *matHeaderCellDef>
              <mat-form-field appearance="outline"  class="w-full mx-auto" >
                <input
                placeholder="Cari"
                  matInput
                  [formControl]="formControls.work_letter_number_ctrl"
                />
              </mat-form-field>
            </th>
          </ng-container>

          <ng-container  matColumnDef="work_letter_month_filter">
            <th mat-header-cell *matHeaderCellDef>
              <mat-form-field appearance="outline"  class="w-full mx-auto" >
                <input
                placeholder="Cari"
                  matInput
                  [formControl]="formControls.work_letter_month_ctrl"
                />
              </mat-form-field>
            </th>
          </ng-container>

          <ng-container  matColumnDef="work_letter_year_filter">
            <th mat-header-cell *matHeaderCellDef>
              <mat-form-field appearance="outline" class="w-full mx-auto">
                <input
                placeholder="Tanggal"
                  matInput
                  [formControl]="formControls.work_letter_year_ctrl"
                  [readonly]="true"
                />
              </mat-form-field>
            </th>
          </ng-container>

          <ng-container  matColumnDef="work_start_date_filter">
            <th mat-header-cell *matHeaderCellDef>
              <mat-form-field appearance="outline"  class="w-full mx-auto" >
                <input
                placeholder="Cari"
                  matInput
                  [formControl]="formControls.work_start_date_ctrl"
                  [matDatepicker]="work_start_date_ctrl"
                  [readonly]="true"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="work_start_date_ctrl"
                ></mat-datepicker-toggle>
                <mat-datepicker #work_start_date_ctrl></mat-datepicker>
              </mat-form-field>
            </th>
          </ng-container>

          <ng-container  matColumnDef="work_end_date_filter">
            <th mat-header-cell *matHeaderCellDef>
              <mat-form-field appearance="outline"  class="w-full mx-auto" >
                <input
                placeholder="Cari"
                  matInput
                  [formControl]="formControls.work_end_date_ctrl"
                  [matDatepicker]="work_end_date_ctrl"
                  [readonly]="true"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="work_end_date_ctrl"
                ></mat-datepicker-toggle>
                <mat-datepicker #work_end_date_ctrl></mat-datepicker>
              </mat-form-field>
            </th>
          </ng-container>

          <ng-container  matColumnDef="form_status_filter">
            <th mat-header-cell *matHeaderCellDef>
              <ng-select
              class="mx-auto"
              appendTo="body"
              [items]="formStatusList"
              bindLabel="name"
              bindValue="value"
              placeholder="Filter Kolom"
              [formControl]="formControls.form_status_ctrl"
            >
            </ng-select>
            </th>
          </ng-container>

          <ng-container  matColumnDef="action_filter" stickyEnd>
            <th mat-header-cell *matHeaderCellDef></th>
          </ng-container>

          <!--Data Section-->

          <ng-container  matColumnDef="none">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element"> </td>
          </ng-container>

          <ng-container  matColumnDef="work_letter_number" >
            <th mat-sort-header="work_letter_number" mat-header-cell *matHeaderCellDef> No Surat </th>
            <td mat-cell *matCellDef="let element"> {{ element?.work_letter_number }} </td>
          </ng-container>

          <ng-container  matColumnDef="work_letter_month" >
            <th mat-sort-header="work_letter_month" mat-header-cell *matHeaderCellDef> Bulan Surat </th>
            <td mat-cell *matCellDef="let element"> {{ element?.work_letter_month }} </td>
          </ng-container>

          <ng-container  matColumnDef="work_letter_year" >
            <th mat-sort-header="work_letter_year" mat-header-cell *matHeaderCellDef> Tahun Surat </th>
            <td mat-cell *matCellDef="let element"> {{ element?.work_letter_year }} </td>
          </ng-container>

          <ng-container  matColumnDef="work_start_date" >
            <th mat-sort-header="work_start_date" mat-header-cell *matHeaderCellDef> Tanggal Awal Dinas </th>
            <td mat-cell *matCellDef="let element"> {{ element?.work_start_date }} </td>
          </ng-container>

          <ng-container  matColumnDef="work_end_date" >
            <th mat-sort-header="work_end_date" mat-header-cell *matHeaderCellDef> Tanggal Akhir Dinas </th>
            <td mat-cell *matCellDef="let element"> {{ element?.work_end_date }} </td>
          </ng-container>

          <ng-container  matColumnDef="form_status" >
            <th mat-sort-header="form_status" mat-header-cell *matHeaderCellDef> Status </th>
            <td mat-cell *matCellDef="let element">
                <button
                (click)="OpenDialogTimeline(element?._id)"
                [matTooltip]="getStatusTooltip(element?.form_status)"
                mat-icon-button
                [ngStyle]="{'color': getStatusColor(element?.form_status)}">
                  <mat-icon>lens</mat-icon>
              </button>
            </td>
          </ng-container>

          <ng-container  matColumnDef="action" stickyEnd>
            <th mat-header-cell *matHeaderCellDef> Action </th>
            <td class="jusify-center" mat-cell *matCellDef="let element">
                <div style="justify-content: center !important;" class="flex flex-row jusify-center align-center gap-1">
                  <div>
                    <button (click)="OpenFormToPreview(element?._id ,element.employee_id._id)" mat-icon-button>
                      <mat-icon  class="cursor-pointer">remove_red_eye</mat-icon>
                    </button>
                  </div>
                  <div>
                    <button *ngIf="element?.form_status === 'completed' || element?.form_status === 'approved'" (click)="OpenPDFLeaveLetter(element?.pdf_work_letter)" mat-icon-button>
                      <mat-icon  class="cursor-pointer text-indigo-900" >picture_as_pdf</mat-icon>
                    </button>
                  </div>
                 </div>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-header-row *matHeaderRowDef="filterCols"></tr>

          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
    </div>

    <div style="text-align: center !important; margin: 20px !important;" class="my-10 text-center w-full" *ngIf="(noData | async)" class="no-records">
      <span class="text-md text-center text-gray-700 font-semibold">Data Tidak Ditemukan</span>
    </div>
    <div [ngClass]="{'hidden': noData | async  }"  >
      <mat-paginator
        [ngClass]="{ 'hide-pagination-buttons': paginator.length <= 10 }"
        [length]="dataCount"
        [hidePageSize]="true"
        [pageSize]="10"
        showFirstLastButtons
      ></mat-paginator>
    </div>
</div>

 <!-- <tr mat-header-row *matHeaderRowDef="['loading']" [hidden]="!isWaitingForResponse"></tr> -->
