<div *ngIf="isWaitingForResponse" class="inner-loading-indicator">
  <mat-spinner color="primary" [diameter]="100"></mat-spinner>
</div>

<div [ngClass]="{'hidden': isWaitingForResponse}"  class="flex flex-col p-5 text-center">
  <h2 class="mt-1">Formulir Permohonan</h2>

  <!--Page Container -->
  <div
    style="background-color: white"
    class="flex flex-col items-left customBorder"
  >
    <!-- Leave Form Section 1 -->
    <div *ngIf="openIdentity" class="flex flex-col justify-between h-full">
      <form [formGroup]="formLeaveIdentity">
        <!-- Form Section -->
        <div class="flex flex-row">
          <div class="flex flex-col items-left w-1/2 pt-3 mr-2">
            <div class="mb-4">
              <div class="flex flex-row mb-6 h-10 items-baseline">
                <div class="w-70 text-left">
                  <span>Jenis Permohonan*</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <mat-select [formControlName]="'application_type'">
                      <mat-option
                        (click)="ChangeAplication()"
                        *ngFor="let item of categoryList"
                        [value]="item.value"
                      >
                        {{ item.name }}
                      </mat-option>
                    </mat-select>
                    <mat-error
                      *ngIf="
                        formLeaveIdentity
                          .get('application_type')
                          .hasError('required')
                      "
                    >
                      Kolom ini wajib diisi
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4" *ngIf="IsTypeIsLeave()">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Waktu Matang Cuti</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input
                      class="w-80"
                      matInput
                      [formControlName]="'date_of_eligible_for_leave'"
                      [disabled]="true"
                      [readonly]="true"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Nama</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input
                      class="w-80"
                      matInput
                      [formControlName]="'name'"
                      [disabled]="true"
                      [readonly]="true"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>NRP</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input
                      matInput
                      [formControlName]="'employee_number'"
                      [readonly]="true"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Status Keluarga</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input
                      matInput
                      [formControlName]="'family_status'"
                      [readonly]="true"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Tanggal Diterima Kerja</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input
                      matInput
                      [formControlName]="'date_of_registration'"
                      [readonly]="true"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>{{
                    formType ? "Alamat " + formType + "*" : "Alamat*"
                  }}</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input matInput [formControlName]="'leave_address'" />
                    <!-- <textarea
                    class="w-80"
                    matInput
                    cdkTextareaAutosize
                    #autosize="cdkTextareaAutosize"
                    cdkAutosizeMinRows="1"
                    cdkAutosizeMaxRows="5"
                    cdkAutosizeMaxCols="3"
                    cols="3"
                    [formControlName]="'leave_address'"
                    ></textarea> -->
                    <mat-error
                      *ngIf="
                        formLeaveIdentity
                          .get('leave_address')
                          .hasError('required')
                      "
                    >
                      Kolom ini wajib diisi
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Tlp Rumah / HP*</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input
                      (keypress)="preventNonNumericalInputPhoneNumber($event)"
                      matInput
                      [formControlName]="'phone_number'"
                    />
                    <mat-error
                      *ngIf="
                        formLeaveIdentity
                          .get('phone_number')
                          .hasError('required')
                      "
                    >
                      Kolom ini wajib diisi
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4" *ngIf="IsTypeIsLeave()">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Kategori Cuti*</span>
                </div>
                <div class="w-80 text-left pl-1">
                  <mat-radio-group
                    [formControlName]="'leave_category'"
                    aria-label="Select an option"
                    (change)="LeaveTypeCondition()"
                  >
                    <mat-radio-button value="lapangan"
                      >Lapangan</mat-radio-button
                    >
                    <mat-radio-button value="tahunan">Tahunan</mat-radio-button>
                  </mat-radio-group>
                  <mat-error
                    class="ml-4"
                    *ngIf="
                      formLeaveIdentity
                        .get('leave_category')
                        .hasError('required') && isSection1Submited
                    "
                  >
                    Kolom ini wajib diisi
                  </mat-error>
                </div>
              </div>
            </div>
            <div class="mb-4" *ngIf="IsTypeIsLeave() === false">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Kategori Ijin*</span>
                </div>
                <div class="w-80 text-left pl-1">
                  <mat-radio-group
                    [formControlName]="'permission_category'"
                    aria-label="Select an option"
                    (change)="PermissionTypeCondition()"
                  >
                    <mat-radio-button value="pp">PP</mat-radio-button>
                    <mat-radio-button value="non_pp">Luar PP</mat-radio-button>
                  </mat-radio-group>
                  <mat-error
                    class="ml-4"
                    *ngIf="
                      formLeaveIdentity
                        .get('permission_category')
                        .hasError('required') && isSection1Submited
                    "
                  >
                    Kolom ini wajib diisi
                  </mat-error>
                </div>
              </div>
            </div>
            <div
              class="mb-4"
              *ngIf="IsTypeIsLeave() === false && permissionType"
            >
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Bantuan Tiket*</span>
                </div>
                <div class="w-80 text-left pl-1">
                  <mat-radio-group
                    [formControlName]="'is_ticket_supported'"
                    aria-label="Select an option"
                    (change)="SelectTicketSupported()"
                  >
                    <mat-radio-button [value]="true">Ada</mat-radio-button>
                    <mat-radio-button [value]="false">Tidak</mat-radio-button>
                  </mat-radio-group>
                  <mat-error
                    *ngIf="
                      formLeaveIdentity
                        .get('is_ticket_supported')
                        .hasError('required') && isSection1Submited
                    "
                  >
                    Kolom ini wajib diisi
                  </mat-error>
                </div>
              </div>
            </div>
          </div>
          <div class="flex flex-col items-left w-1/2 pt-3">
            <div class="mb-4" *ngIf="IsTypeIsLeave()">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Bantuan Tiket*</span>
                </div>
                <div class="w-80 text-left pl-1">
                  <mat-radio-group
                    (change)="SelectTicketSupported()"
                    [formControlName]="'is_ticket_supported'"
                    aria-label="Select an option"
                  >
                    <mat-radio-button [value]="true">Ada</mat-radio-button>
                    <mat-radio-button [value]="false">Tidak</mat-radio-button>
                  </mat-radio-group>
                  <mat-error
                    *ngIf="
                      formLeaveIdentity
                        .get('is_ticket_supported')
                        .hasError('required') && isSection1Submited
                    "
                  >
                    Kolom ini wajib diisi
                  </mat-error>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Status Penerimaan POH</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input
                      matInput
                      [formControlName]="'poh_status'"
                      [readonly]="true"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Jabatan</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input
                      matInput
                      [formControlName]="'position'"
                      [readonly]="true"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Status Penempatan</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input
                      matInput
                      [formControlName]="'placement_status'"
                      [readonly]="true"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Membawa Keluarga*</span>
                </div>
                <div class="w-80 text-left pl-1">
                  <mat-radio-group
                    [formControlName]="'is_with_family'"
                    aria-label="Select an option"
                  >
                    <mat-radio-button [value]="true">Ya</mat-radio-button>
                    <mat-radio-button [value]="false">Tidak</mat-radio-button>
                  </mat-radio-group>
                  <mat-error
                    class="ml-2"
                    *ngIf="
                      formLeaveIdentity
                        .get('is_with_family')
                        .hasError('required') && isSection1Submited
                    "
                  >
                    Kolom ini wajib diisi
                  </mat-error>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>ST Dinas Rutin</span>
                </div>
                <div class="w-80 text-left pl-1">
                  <mat-radio-group
                    [formControlName]="'is_routine_official_letter'"
                    aria-label="Select an option"
                  >
                    <mat-radio-button [value]="true">Ada</mat-radio-button>
                    <mat-radio-button [value]="false">Tidak</mat-radio-button>
                  </mat-radio-group>
                </div>
              </div>
            </div>
            <div class="mb-4">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>{{
                    formType
                      ? "Tempat Tujuan " + formType + "*"
                      : "Tempat Tujuan*"
                  }}</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input matInput [formControlName]="'leave_location'" />
                    <mat-error
                      *ngIf="
                        formLeaveIdentity
                          .get('leave_location')
                          .hasError('required')
                      "
                    >
                      Kolom ini wajib diisi
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="mb-4" *ngIf="IsTypeIsLeave()">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Bantuan Biaya Cuti (Lump Sump)</span>
                </div>
                <div class="w-80 text-left pl-1">
                  <mat-radio-group
                    [formControlName]="'is_lump_sump'"
                    aria-label="Select an option"
                  >
                    <mat-radio-button [value]="true">Ada</mat-radio-button>
                    <mat-radio-button [value]="false">Tidak</mat-radio-button>
                  </mat-radio-group>
                </div>
              </div>
            </div>
            <div class="mb-4" *ngIf="IsTypeIsLeave()">
              <div class="flex flex-row h-10 mb-6 items-baseline">
                <div class="w-70 text-left">
                  <span>Besarnya bantuan Biaya Cuti</span>
                </div>
                <div>
                  <mat-form-field appearance="outline" class="w-80">
                    <input matInput [formControlName]="'lump_sump_amount'" />
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
      <!-- Button Group -->
      <div *ngIf="!isPreviewMode" class="self-end">
        <button (click)="CancelCreateForm()" mat-raised-button color="warn">
          Batalkan
        </button>
        <button
          (click)="SaveIdentity()"
          class="ml-2"
          mat-raised-button
          color="primary"
        >
          Simpan
        </button>
      </div>
    </div>

    <div *ngIf="isPreviewMode" class="w-full my-10">
      <mat-divider></mat-divider>
    </div>

    <!-- Leave Form Section 2 -->
    <div *ngIf="openDetailRequest" class="flex flex-col my-10 justify-between h-full">
      <div *ngIf="!isPreviewMode" class="ml-1 self-start mb-3">
        <button (click)="OpenIdentity()" color="accent" mat-raised-button>
          Kembali
        </button>
      </div>
      <!-- FORM IZIN START -->
      <form  [formGroup]="formLeaveDetailRequest">
        <!-- Form Section -->
        <div class="flex flex-col">
          <div
            *ngIf="
              (IsTypeIsLeave() &&
                !IsLeaveCategoryIsYearly() &&
                formLeaveIdentity.get('is_ticket_supported').value) ||
              permissionType === 'pp'
            "
            class="flex flex-row h-10 mb-6 items-baseline w-[75%]"
          >
            <div class="w-70 text-left">
              <span>Tanggal Berangkat (hari off)*</span>
            </div>
            <div>
              <mat-form-field appearance="outline" class="testing">
                <input
                  (dateInput)="ResetTravelDate()"
                  matInput
                  [formControlName]="'departure_off_day'"
                  [matDatepicker]="pickerdeparture_off_day"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="pickerdeparture_off_day"
                ></mat-datepicker-toggle>
                <mat-datepicker #pickerdeparture_off_day></mat-datepicker>
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('departure_off_day')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave() === false && permissionType === 'pp'"
            class="flex flex-row h-10 mb-6 items-baseline w-[75%]"
          >
            <div class="w-70 text-left">
              <span>Alasan Ijin*</span>
            </div>
            <div>
              <!-- <mat-form-field appearance="outline" class="w-80">
                <input
                  (focusout)="SelectPermissionType()"
                  matInput
                  formControlName="permission_type"
                  [matAutocomplete]="permissionList"
                />
                <mat-autocomplete #permissionList="matAutocomplete">
                  <mat-option
                    (click)="SelectPermissionType()"
                    *ngFor="let item of filteredPermission | async"
                    [value]="item.name"
                  >
                    {{ item.name }}
                  </mat-option>
                </mat-autocomplete> -->
              <!--
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('permission_type')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field> -->
              <div class="w-80">
                <ng-select
                  class="min-w-80"
                  appendTo="body"
                  [items]="permissionList"
                  bindLabel="name"
                  bindValue="name"
                  placeholder="pilih alasan izin"
                  formControlName="permission_type"
                  (change)="SelectPermissionType()"
                >
                </ng-select>
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('permission_type')
                      .hasError('required') && isSection2Submited
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </div>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave() === false && permissionType === 'non_pp'"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Alasan Ijin*</span>
            </div>
            <div>
              <mat-form-field appearance="outline" class="w-80">
                <input matInput formControlName="permission_type" />
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('permission_type')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave() === false"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Jumlah Hari Ijin*</span>
            </div>
            <div>
              <mat-form-field appearance="outline" class="w-80">
                <input
                  (keypress)="preventNonNumericalInput($event)"
                  (focusout)="ResetFieldAfterInputPermissionAmount()"
                  matInput
                  [formControlName]="'permission_duration'"
                />
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('permission_duration')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave() === false"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Tanggal Ijin</span>
            </div>
            <div class="flex flex-row items-baseline">
              <mat-form-field appearance="outline" class="testing">
                <input
                  (dateInput)="CalculatePermissionLeaveDate()"
                  matInput
                  [formControlName]="'permission_start_date'"
                  [matDatepicker]="picker_permission_start"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_permission_start"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker_permission_start></mat-datepicker>
              </mat-form-field>
              <span class="mx-1">s/d</span>
              <mat-form-field appearance="outline" class="testing">
                <input
                  matInput
                  [formControlName]="'permission_end_date'"
                  [matDatepicker]="picker_permission_end"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_permission_end"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker_permission_end></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="
              IsTypeIsLeave() &&
              !IsLeaveCategoryIsYearly() &&
              formLeaveIdentity.get('is_ticket_supported').value
            "
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Perjalanan*</span>
            </div>
            <div>
              <mat-form-field appearance="outline" class="testing">
                <input
                  (dateInput)="ResetBottomData()"
                  matInput
                  [formControlName]="'travel_date'"
                  [matDatepicker]="pickertravel_date"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="pickertravel_date"
                ></mat-datepicker-toggle>
                <mat-datepicker #pickertravel_date></mat-datepicker>
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('travel_date')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave() && !IsLeaveCategoryIsYearly()"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Jumlah Hari Cuti Lapangan*</span>
            </div>
            <div>
              <mat-form-field appearance="outline" class="w-80">
                <input
                  (focusout)="CalculateLeaveDate('first')"
                  (keypress)="preventNonNumericalInput($event)"
                  matInput
                  [formControlName]="'field_leave_duration'"
                />
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('field_leave_duration')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave() && !IsLeaveCategoryIsYearly()"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 pr-1 text-left truncate">
              <span>Tanggal Cuti (Waktu Cuti Aktif)*</span>
            </div>
            <div class="flex flex-row custom-w items-baseline">
              <mat-form-field appearance="outline" class="testing">
                <input
                  (dateInput)="CalculateLeaveDate('last')"
                  matInput
                  [formControlName]="'field_leave_start_date'"
                  [matDatepicker]="picker_leave_date_start"
                  [readonly]="false"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_leave_date_start"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker_leave_date_start></mat-datepicker>
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('field_leave_start_date')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
              <span class="mx-1">s/d</span>
              <mat-form-field appearance="outline" class="testing">
                <input
                  matInput
                  [formControlName]="'field_leave_end_date'"
                  [matDatepicker]="picker_leave_date_end"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_leave_date_end"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker_leave_date_end></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="
              (IsTypeIsLeave() && !IsLeaveCategoryIsYearly()) ||
              permissionType === 'pp'
            "
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Tambah Cuti Tahunan*</span>
            </div>
            <div class="w-80 text-left pl-1">
              <mat-radio-group
                (change)="SelectYealyLeave()"
                [formControlName]="'is_yearly_leave'"
                aria-label="Select an option"
              >
                <mat-radio-button [value]="true">Ya</mat-radio-button>
                <mat-radio-button [value]="false">Tidak</mat-radio-button>
              </mat-radio-group>
              <mat-error
                *ngIf="
                  formLeaveDetailRequest
                    .get('is_yearly_leave')
                    .hasError('required') && isSection2Submited
                "
              >
                Kolom ini wajib diisi
              </mat-error>
            </div>
          </div>
          <div
            *ngIf="IsYearlySelected()"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Jumlah Hari Cuti Tahunan*</span>
            </div>
            <div class="flex flex-row items-baseline">
              <mat-form-field appearance="outline" class="w-80">
                <input
                  (focusout)="CalculateYearlyLeaveDate()"
                  (keypress)="preventNonNumericalInput($event)"
                  matInput
                  [formControlName]="'yearly_leave_duration'"
                />
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('yearly_leave_duration')
                      .hasError('pattern')
                  "
                >
                  Maksimal 6 Hari
                </mat-error>
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('yearly_leave_duration')
                      .hasError('exceedLimit') &&
                    !formLeaveDetailRequest
                      .get('yearly_leave_duration')
                      .hasError('pattern')
                  "
                >
                  Jumlah melebihi sisa cuti
                </mat-error>
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('yearly_leave_duration')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
              <div class="rounded py-2 px-1 ml-2 primary w-full">
                Sisa Cuti Tahunan: {{ remainingYearlyLeaves }}
              </div>
            </div>
          </div>
          <div
            *ngIf="IsYearlySelected()"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Tanggal Cuti Tahunan</span>
            </div>
            <div class="flex flex-row items-baseline">
              <mat-form-field appearance="outline" class="testing">
                <input
                  (dateInput)="CalculateEndYearlyLeaveDate()"
                  matInput
                  [formControlName]="'yearly_leave_start_date'"
                  [matDatepicker]="picker_leave_yearly_start"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_leave_yearly_start"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker_leave_yearly_start></mat-datepicker>
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('yearly_leave_start_date')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
              <span class="mx-1">s/d</span>
              <mat-form-field appearance="outline" class="testing">
                <input
                  matInput
                  [formControlName]="'yearly_leave_end_date'"
                  [matDatepicker]="picker_leave_yearly_end"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_leave_yearly_end"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker_leave_yearly_end></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave()"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Tambah Ijin*</span>
            </div>
            <div class="w-80 text-left pl-1">
              <mat-radio-group
                (change)="SelectPermission()"
                [formControlName]="'is_permission'"
                aria-label="Select an option"
              >
                <mat-radio-button [value]="true">Ya</mat-radio-button>
                <mat-radio-button [value]="false">Tidak</mat-radio-button>
              </mat-radio-group>
              <mat-error
                *ngIf="
                  formLeaveDetailRequest
                    .get('is_permission')
                    .hasError('required') && isSection2Submited
                "
              >
                Kolom ini wajib diisi
              </mat-error>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave() && IsPermissionSelected()"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Alasan Ijin*</span>
            </div>
            <div>
              <!-- <mat-form-field appearance="outline" class="w-80">
                <input
                  (focusout)="SelectPermissionType()"
                  matInput
                  formControlName="permission_type"
                  [matAutocomplete]="permissionList"
                />
                <mat-autocomplete #permissionList="matAutocomplete">
                  <mat-option
                    (click)="SelectPermissionType()"
                    *ngFor="let item of filteredPermission | async"
                    [value]="item.name"
                  >
                    {{ item.name }}
                  </mat-option>
                </mat-autocomplete>
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('permission_type')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field> -->
              <div class="w-80">
                <ng-select
                  class="w-80"
                  appendTo="body"
                  [items]="permissionList"
                  bindLabel="name"
                  bindValue="name"
                  placeholder="Pilih alasan izin"
                  formControlName="permission_type"
                  (change)="SelectPermissionType()"
                >
                </ng-select>
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('permission_type')
                      .hasError('required') && isSection2Submited
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </div>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave() && IsPermissionSelected()"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Jumlah Hari Ijin*</span>
            </div>
            <div>
              <mat-form-field appearance="outline" class="w-80">
                <input
                  (keypress)="preventNonNumericalInput($event)"
                  (focusout)="CalculatePermissionLeaveDate()"
                  matInput
                  [formControlName]="'permission_duration'"
                />
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('permission_duration')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave() && IsPermissionSelected()"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Tanggal Ijin</span>
            </div>
            <div class="flex flex-row items-baseline">
              <mat-form-field appearance="outline" class="testing">
                <input
                  matInput
                  [formControlName]="'permission_start_date'"
                  [matDatepicker]="picker_permission_start"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_permission_start"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker_permission_start></mat-datepicker>
              </mat-form-field>
              <span class="mx-1">s/d</span>
              <mat-form-field appearance="outline" class="testing">
                <input
                  matInput
                  [formControlName]="'permission_end_date'"
                  [matDatepicker]="picker_permission_end"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_permission_end"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker_permission_end></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="IsTypeIsLeave() && !IsLeaveCategoryIsYearly()"
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Tambah Kompensasi*</span>
            </div>
            <div class="w-80 text-left pl-1">
              <mat-radio-group
                (change)="IsCompensationSelected()"
                [formControlName]="'is_compensation'"
                aria-label="Select an option"
              >
                <mat-radio-button [value]="true">Ya</mat-radio-button>
                <mat-radio-button [value]="false">Tidak</mat-radio-button>
              </mat-radio-group>
              <mat-error
                *ngIf="
                  formLeaveDetailRequest
                    .get('is_compensation')
                    .hasError('required') && isSection2Submited
                "
              >
                Kolom ini wajib diisi
              </mat-error>
            </div>
          </div>
          <div
            *ngIf="
              IsTypeIsLeave() &&
              !IsLeaveCategoryIsYearly() &&
              IsCompensationSelected()
            "
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Jumlah Hari Kompensasi*</span>
            </div>
            <div>
              <mat-form-field appearance="outline" class="w-80">
                <input
                  (keypress)="preventNonNumericalInput($event)"
                  (focusout)="CalculateCompensationLeaveDate()"
                  matInput
                  [formControlName]="'compensation_duration'"
                />
                <mat-error
                  *ngIf="
                    formLeaveDetailRequest
                      .get('compensation_duration')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div
            *ngIf="
              IsTypeIsLeave() &&
              !IsLeaveCategoryIsYearly() &&
              IsCompensationSelected()
            "
            class="flex flex-row h-10 mb-6 items-baseline w-2/3"
          >
            <div class="w-70 text-left">
              <span>Tanggal Kompensasi*</span>
            </div>
            <div class="flex flex-row items-baseline">
              <mat-form-field class="w-43" appearance="outline" class="testing">
                <input
                  matInput
                  [formControlName]="'compensation_start_date'"
                  [matDatepicker]="picker_compensation_start"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_compensation_start"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker_compensation_start></mat-datepicker>
              </mat-form-field>
              <span class="mx-1">s/d</span>
              <mat-form-field class="w-43" appearance="outline" class="testing">
                <input
                  matInput
                  [formControlName]="'compensation_end_date'"
                  [matDatepicker]="picker_compensation_end"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_compensation_end"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker_compensation_end></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
        </div>
      </form>
      <!-- FORM IZIN END -->
      <!-- Button Group -->
      <div *ngIf="!isPreviewMode" class="self-end">
        <button (click)="CancelCreateForm()" mat-raised-button color="warn">
          Batalkan
        </button>
        <button
          (click)="SaveDetailRequest()"
          class="ml-2"
          mat-raised-button
          color="primary"
        >
          Simpan
        </button>
      </div>
    </div>

    <div *ngIf="isPreviewMode" class="w-full my-10">
      <mat-divider></mat-divider>
    </div>

    <!-- Leave Form Section 3 -->
    <div
      *ngIf="openTicektApproval"
      class="flex flex-col justify-between h-full my-10"
    >
      <div *ngIf="!isPreviewMode" class="ml-1 self-start mb-3">
        <button (click)="OpenDetailRequest()" color="accent" mat-raised-button>
          Kembali
        </button>
      </div>
      <form [formGroup]="formLeaveTicektApproval">
        <!-- Form Section -->
        <div class="mr-5">
          <div class="flex flex-row h-10 mb-6 items-baseline">
            <div class="w-70 text-left">
              <span>Tanggal Cuti Total</span>
            </div>
            <div class="flex flex-row items-baseline">
              <mat-form-field appearance="outline" class="testing">
                <input
                  matInput
                  [formControlName]="'leave_date_start_TicektApproval'"
                  [matDatepicker]="picker_leave_date_start_TicektApproval"
                  [readonly]="true"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_leave_date_start_TicektApproval"
                ></mat-datepicker-toggle>
                <mat-datepicker
                  #picker_leave_date_start_TicektApproval
                ></mat-datepicker>
              </mat-form-field>
              <span class="mx-1">s/d</span>
              <mat-form-field appearance="outline" class="testing">
                <input
                  matInput
                  [formControlName]="'leave_date_end_TicektApproval'"
                  [matDatepicker]="picker_leave_date_end_TicektApproval"
                  [readonly]="true"
                  [min]="minDate"
                />
                <mat-datepicker-toggle
                  matIconSuffix
                  [for]="picker_leave_date_end_TicektApproval"
                ></mat-datepicker-toggle>
                <mat-datepicker
                  #picker_leave_date_end_TicektApproval
                ></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
          <div class="flex flex-row h-10 mb-6 items-baseline">
            <div class="w-70 text-left">
              <span>Total (Hari)</span>
            </div>
            <div>
              <mat-form-field appearance="outline" class="w-80">
                <input
                  matInput
                  [formControlName]="'total_leave_amount'"
                  [readonly]="true"
                />
              </mat-form-field>
            </div>
          </div>
          <div class="flex flex-row h-10 mb-6 items-baseline">
            <div class="w-70 text-left">
              <span>Keterangan*</span>
            </div>
            <div>
              <mat-form-field appearance="outline" class="w-80">
                <input matInput [formControlName]="'leave_comment'" />
                <mat-error
                  *ngIf="
                    formLeaveTicektApproval
                      .get('leave_comment')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- FORM ARRAY TICKET TRAVEL SECTION -->
          <div formArrayName="travel_tickets">
            <div *ngIf="formLeaveIdentity.get('is_ticket_supported').value">
              <h3 class="mb-1 text-left">Pemesanan Tiket Pesawat/Travel</h3>
              <h5 class="mt-1 mb-6 text-left">
                *mohon diisi apabila ingin memesan tiket pesawat
              </h5>
              <div
                class="flex flex-col mb-6 w-max"
                *ngFor="let ticket of ticketsTravel.controls; let i = index"
                [formGroupName]="i"
              >
                <div class="flex flex-row h-10 mb-6 items-baseline">
                  <div class="flex flex-row h-10 mr-5 items-baseline">
                    <div class="w-20 text-left">
                      <span>{{ i + 1 + ". Nama" }}</span>
                    </div>
                    <div>
                      <mat-form-field class="w-70" appearance="outline">
                        <input class="w-80" matInput formControlName="name" />
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="flex flex-row h-10 items-baseline">
                    <div class="w-15 mr-1 text-left">
                      <span>Usia</span>
                    </div>
                    <div>
                      <mat-form-field class="w-43" appearance="outline">
                        <input
                          (keypress)="preventNonNumericalInput($event)"
                          class="w-80"
                          matInput
                          formControlName="age"
                        />
                      </mat-form-field>
                    </div>
                  </div>
                </div>
                <div class="flex flex-row h-10 mb-6 items-baseline">
                  <div class="w-30 text-left">
                    <span>Berangkat</span>
                  </div>
                  <div class="flex flex-row h-10 mb-3 mr-3 items-baseline">
                    <div class="w-11 text-left">
                      <span>Dari</span>
                    </div>
                    <div>
                      <mat-form-field class="w-43" appearance="outline">
                        <input
                          [disabled]="true"
                          [readonly]="true"
                          class="w-80"
                          matInput
                          formControlName="departure_from"
                        />
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="flex flex-row h-10 mb-6 items-baseline">
                    <div class="w-10 mr-7 text-left">
                      <span>Menuju*</span>
                    </div>
                    <div>
                      <ng-select
                        class="w-43"
                        [items]="airPortList"
                        appendTo="body"
                        bindLabel="name"
                        bindValue="name"
                        placeholder="Pilih Kota"
                        formControlName="departure_to"
                        (change)="UpdateAirPortFormArrFrom()"
                      >
                        <!-- <ng-option *ngFor="let item of airPortList">
                      {{ item.name }}
                    </ng-option> -->
                      </ng-select>
                      <mat-error
                        *ngIf="
                          ticketsTravel
                            .at(i)
                            .get('departure_to')
                            .hasError('required') && isSection3Submited
                        "
                      >
                        Kolom ini wajib diisi
                      </mat-error>
                    </div>
                  </div>
                </div>
                <div class="flex flex-row h-10 mb-6 items-baseline">
                  <div class="w-30 text-left">
                    <span>Kembali</span>
                  </div>
                  <div class="flex flex-row h-10 mb-3 mr-3 items-baseline">
                    <div class="w-11 text-left">
                      <span>Dari*</span>
                    </div>
                    <div>
                      <ng-select
                        class="w-43"
                        appendTo="body"
                        [items]="airPortList"
                        bindLabel="name"
                        bindValue="name"
                        placeholder="Pilih Kota"
                        formControlName="arrival_from"
                        (change)="UpdateAirPortFormArrFrom()"
                      >
                      </ng-select>
                      <mat-error
                        *ngIf="
                          ticketsTravel
                            .at(i)
                            .get('arrival_from')
                            .hasError('required') && isSection3Submited
                        "
                      >
                        Kolom ini wajib diisi
                      </mat-error>
                    </div>
                  </div>

                  <div class="flex flex-row h-10 mb-6 items-baseline">
                    <div class="w-10 mr-7 text-left">
                      <span>Menuju</span>
                    </div>
                    <div>
                      <mat-form-field class="w-43" appearance="outline">
                        <input
                          [disabled]="true"
                          [readonly]="true"
                          class="w-80"
                          matInput
                          formControlName="arrival_to"
                        />
                      </mat-form-field>
                    </div>
                  </div>
                </div>
                <div
                  *ngIf="
                    IsPohNonLocalPerumahan() &&
                    formLeaveIdentity.get('is_ticket_supported').value &&
                    ticketsTravel.length === i + 1 &&
                    formLeaveIdentity.get('is_with_family').value
                  "
                  class="self-end"
                >
                  <button
                    *ngIf="i > 0"
                    (click)="RemoveTicket(i)"
                    class="py-1 px-2 text-xs"
                    mat-raised-button
                    color="warn"
                  >
                    hapus
                  </button>
                  <button
                    *ngIf="i <= 3"
                    (click)="CreateTicketTravelArray()"
                    class="ml-2 py-1 px-2 text-xs"
                    mat-raised-button
                    color="primary"
                  >
                    tambah
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- END FORM ARRAY TICKET TRAVEL -->

          <!-- START PEJABAT PENGGANTI SECTION -->
          <h3 class="text-left my-2">Pejabat Pengganti</h3>
          <div class="flex flex-row h-10 mb-6 items-baseline">
            <div class="w-70 text-left">
              <span>Pejabat Sementara Selama Cuti*</span>
            </div>
            <div>
              <!-- <mat-form-field appearance="outline" class="w-80">
                <input
                  matInput
                  formControlName="substitute_officer"
                  [matAutocomplete]="substitute_officer"
                  (focusout)="selectSubtituteOfficer()"
                />
                <mat-autocomplete #substitute_officer="matAutocomplete">
                  <mat-option
                    (click)="selectSubtituteOfficer()"
                    *ngFor="let item of filteredSubtituteOfficer | async"
                    [value]="item.name"
                  >
                    {{ item?.employee_number }} {{ item?.name }}
                  </mat-option>
                </mat-autocomplete>
                <mat-error
                  *ngIf="
                    formLeaveTicektApproval
                      .get('substitute_officer')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field> -->
              <div class="w-80">
                <ng-select
                  appendTo="body"
                  [items]="substituteOfficerList"
                  bindLabel="displayName"
                  bindValue="_id"
                  placeholder="Pilih Karyawan"
                  formControlName="substitute_officer"
                  (change)="selectSubtituteOfficer()"
                >
                </ng-select>
                <mat-error
                  *ngIf="
                    formLeaveTicektApproval
                      .get('substitute_officer')
                      .hasError('required') && isSection3Submited
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </div>
            </div>
          </div>
          <div class="flex flex-row h-10 mb-6 items-baseline">
            <div class="w-70 text-left">
              <span>Daftar Job Pending*</span>
            </div>
            <div>
              <mat-form-field class="w-80 custom-h" appearance="outline">
                <input
                  class="w-80"
                  matInput
                  [formControlName]="'pending_job'"
                />
                <!-- <textarea
                class="w-80"
                matInput
                cdkTextareaAutosize
                #autosize="cdkTextareaAutosize"
                cdkAutosizeMinRows="1"
                cdkAutosizeMaxRows="5"
                cdkAutosizeMaxCols="3"
                cols="3"
                [formControlName]="'pending_job'"
                ></textarea> -->
                <mat-error
                  *ngIf="
                    formLeaveTicektApproval
                      .get('pending_job')
                      .hasError('required')
                  "
                >
                  Kolom ini wajib diisi
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <!-- END PEJABAT PENGGANTI  -->

          <!-- START PERSETUJUAN CUTI -->
          <h3 class="text-left my-2">Persetujuan Cuti</h3>
          <div class="flex flex-row h-10 mb-6 items-baseline">
            <div class="w-70 text-left">
              <span>Persetujuan 1*</span>
            </div>
            <div>
              <mat-form-field appearance="outline">
                <input
                  class="w-80"
                  matInput
                  [formControlName]="'approval_id_1'"
                  [disabled]="true"
                  [readonly]="true"
                />
              </mat-form-field>
            </div>
          </div>
          <div class="flex flex-row h-10 mb-6 items-baseline">
            <div class="w-70 text-left">
              <span>Persetujuan 2*</span>
            </div>
            <div>
              <mat-form-field appearance="outline">
                <input
                  class="w-80"
                  matInput
                  [formControlName]="'approval_id_2'"
                  [disabled]="true"
                  [readonly]="true"
                />
              </mat-form-field>
            </div>
          </div>
          <div class="flex flex-row h-10 mb-6 items-baseline">
            <div class="w-70 text-left">
              <span>Persetujuan 3*</span>
            </div>
            <div>
              <mat-form-field appearance="outline">
                <input
                  class="w-80"
                  matInput
                  [formControlName]="'approval_id_3'"
                  [disabled]="true"
                  [readonly]="true"
                />
              </mat-form-field>
            </div>
          </div>
          <!-- END PERSETUJUAN CUTI -->
        </div>
      </form>
      <!--Reason Start-->
      <div *ngIf="isRevision || isRejected" class="p-10 w-100 h-50 text-left rounded-lg reason-border my-10">
        <div>
          <h3 class="m-0 p-0">
            Alasan
          </h3>
        </div>
       <div class="my-3">
        <mat-divider></mat-divider>
       </div>
        <div class="mt-5">
          <span>
            {{reasonText}}
          </span>
        </div>
      </div>
      <!--Reason End-->
      <!-- Button Group -->
      <div *ngIf="!isPreviewMode" class="self-end">
        <button (click)="CancelCreateForm()" mat-raised-button color="warn">
          Batalkan
        </button>
        <button
          class="ml-2"
          mat-raised-button
          color="primary"
          (click)="consoleLOG(); SaveTicektApproval()"
        >
          Ajukan Permohonan
        </button>
      </div>
      <div *ngIf="isPreviewMode" class="flex flex-row justify-between">
        <div class="self-end gap-3">
          <button
            (click)="CancelCreateForm()"
            class="ml-2"
            color="warn"
            mat-raised-button
          >
            Batalkan
          </button>
        </div>
        <div class="flex flex-row self-end">
          <div *ngIf="ButtonApproveCondition()">
            <button
              (click)="OpenDialogApproval('cancel')"
              mat-raised-button
              color="warn"
            >
              Tolak
            </button>
          </div>
          <div *ngIf="ButtonApproveCondition()" class="ml-2">
            <button
              (click)="OpenDialogApproval('revision')"
              mat-raised-button
              color="accent"
            >
              Revisi
            </button>
          </div>
          <div *ngIf="ButtonApproveCondition()" class="ml-2">
            <button (click)="ApproveForm()" mat-raised-button color="primary">
              Setuju
            </button>
          </div>
          <div class="ml-2">
            <button (click)="EditForm()" mat-raised-button color="primary">
              Edit
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- <div class="absolute inset-0 flex items-center justify-center">
        <mat-spinner class="text-white" aria-label="Loading"></mat-spinner>
    </div>     -->
</div>

<!-- <div class="flex flex-col p-5 text-center ">
    <div>
        content
    </div>

    <div>
        <mat-spinner></mat-spinner>
    </div>
</div> -->
